@page "/"
@rendermode InteractiveServer
@using MisFinanzas.Components.Layout
@layout MinimalLayout
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IJSRuntime JSRuntime



<PageTitle>Mis Finanzas - Gestión Financiera Inteligente</PageTitle>

<div class="home-container" style="min-height: 100vh; padding: 20px;">

    <AuthorizeView>
        <Authorized>
            @* Vista para usuarios autenticados *@
            <div style="min-height: 100vh; padding: 20px; width:100%;">

                <!-- Navigation Bar Autenticado -->
                <nav class="glass-nav animate-slide-up" style="padding: 15px 30px; margin-bottom: 40px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div class="navigation-bar">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="/images/MisFinanzas.png" alt="Mis Finanzas Logo" style="width: 40px; height: 40px;" />
                            <h3 style="margin: 0; color: white; font-weight: 600;">Mis Finanzas</h3>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <span style="color: rgba(255, 255, 255, 0.9); font-size: 1rem;">
                                ¡Hola, <strong>@context.User.Identity?.Name</strong>! 👋
                            </span>

                            <form action="/Account/Logout" method="post" class="logout-form">
                                <AntiforgeryToken />
                                <input type="hidden" name="ReturnUrl" value="@currentUrl" />

                                
                            </form>
                        </div>
                        <div class="link-autorized">
                            <a href="/dashboard" class="btnLogin" id="home-dashboard-button">Ir a control</a>
                        </div>

                    </div>
                </nav>

                <div class="glass-card animate-slide-up animate-delay-1" style="padding: 20px 20px; text-align: center; margin-bottom: 20px; display:grid;">
                    <div class="title" style="display:flex; align-items:center; margin:0 auto; flex-wrap: wrap; justify-content: center; gap: 10px;">
                        <img src="/images/MisFinanzas.png" alt="Mis Finanzas Logo" style="width: 100px; height: 100px;" />
                        <h1 style="color: white; font-size: 2.5rem; margin-bottom: 8px; margin-top:0px; font-weight: 600;">
                            Mis Finanzas
                        </h1>
                    </div>
                    <p class="text-white" style="font-size: 1.3rem; max-width: 600px; margin: 0 auto;">
                        Toma el control de tu dinero con inteligencia, simplicidad, y con ayuda de Finn 🤖
                    </p>
                    <p class="text-white">
                        Tu asistente financiero personal con Inteligencia Artificial.
                        <br>
                        Háblale por texto o voz, pídele que registre gastos o que cree categorías por ti.
                    </p>
                </div>

                <div style="display: flex; justify-content: center; align-items: center; width: 100%;">

                    <!-- Features Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px; width: 100%; max-width: 900px; padding: 0 20px;">

                        <!-- FILA 1: Categorías + Presupuestos -->
                        <!-- Categories Card -->
                        <div class="glass-card animate-slide-up animate-delay-3" id="home-categories-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🏷️</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Categorías</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Organiza tus finanzas por categorías personalizadas
                            </p>
                            <div>
                                <img src="images/Categories-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">                           
                            </div>                          
                        </div>

                        <!-- Budgets Card -->
                        <div class="glass-card animate-slide-up animate-delay-3" id="home-budgets-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">💰</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Presupuestos</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Controla tus gastos mensuales por categoría
                            </p>
                            <div>
                                <img src="images/Budgets-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Presupuestos">
                            </div>                         
                        </div>

                        <!-- FILA 2: Gastos e Ingresos + Recordatorios -->
                        <!-- Transactions Card -->
                        <div class="glass-card animate-slide-up animate-delay-4" id="home-transactions-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">💳</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Gastos e ingresos</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Registra y visualiza cada movimiento de dinero
                            </p>
                            <div>
                                <img src="images/Expenses-incomes-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de gastos e ingresos">
                            </div>                          
                        </div>

                        <!-- Reminders/Notifications Card (NUEVO) -->
                        <div class="glass-card animate-slide-up animate-delay-4" id="home-reminders-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🔔</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Recordatorios</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Notificaciones de gastos fijos y pagos pendientes
                            </p>
                            <div>
                                <img src="images/Reminders-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Recordatorios">
                            </div>                           
                        </div>

                        <!-- FILA 3: Metas Financieras + Préstamos -->
                        <!-- Financial Goals Card -->
                        <div class="glass-card animate-slide-up animate-delay-5" id="home-goals-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🎯</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Metas financieras</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Define objetivos y alcanza tus sueños
                            </p>
                            <div>
                                <img src="images/Goals-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Metas">
                            </div>
                        </div>

                        <!-- Loans Card (NUEVO) -->
                        <div class="glass-card animate-slide-up animate-delay-5" id="home-loans-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🏦</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Préstamos</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Gestiona tus préstamos y cuotas mensuales
                            </p>
                            <div>
                                <img src="images/Loans-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Prestamos">
                            </div>                           
                        </div>
                    </div>
                </div>

                <!-- FILA 4: Panel de Control (ancho completo) -->
                <div style="display: flex; justify-content: center; margin-top: 30px;">
                    <div style="width: 100%; max-width: 900px; padding: 0 20px;">
                        <div class="glass-card animate-slide-up animate-delay-2" id="home-dashboard-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">📊</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Panel de control</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Visualiza tu situación financiera de un vistazo
                            </p>
                            <div>
                                <img src="images/Balance-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Balance">
                            </div>                        
                            <!-- Contenedor de ambos gráficos - RESPONSIVE -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; align-items:center;">

                                <!-- Gráfico de barras -->
                                <div style="margin: 0 auto; margin-right:30px;">
                                    <img src="images/Barchart-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de barras">
                                </div>                                                            
                                <!-- Gráfico de dona (NUEVO) -->
                                <div style="margin: 0 auto; margin-right:30px;" >
                                    <img src="images/Donut-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de dona">
                                </div>                                
                            </div>                           
                        </div>
                    </div>
                </div>

                <!-- Call to Action - Manual de Usuario -->
                <div class="glass-card animate-slide-up" style="padding: 50px 40px; text-align: center; margin-top: 60px; margin-bottom: 40px;">
                    <h2 style="color: white; font-size: 2rem; margin-bottom: 15px;">¿Deseas una guía detallada de cómo usar la app?</h2>
                    <p style="color: white; font-size: 1.1rem; margin-bottom: 30px;">
                        Aprende como administrar tus finanzas
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btnLogin" id="home-download-manual-button" style="font-size: 1.1rem; padding: 14px 32px;" @onclick="DownloadUserManual">
                            📥 Descargar manual de usuario
                        </button>
                    </div>
                </div>

                <!-- Contact Card (NUEVO) -->
                <div class="glass-card animate-slide-up" id="home-contact-card" style="padding: 40px; text-align: center; margin-bottom: 40px;">
                    <h2 style="color: white; font-size: 1.8rem; margin-bottom: 10px;">📞 ¿Necesitas ayuda?</h2>
                    <p style="color: white; font-size: 1rem; margin-bottom: 25px;">
                        Contáctanos y con gusto te asistiremos
                    </p>

                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <!-- WhatsApp -->
                        <a class="btnWhatsApp" href="https://wa.me/18295346850" target="_blank">
                            <span style="font-size: 24px;">💬</span>
                            <span>WhatsApp</span>
                        </a>

                        <!-- Email -->
                        <a class="btnEmail" href="mailto:soporte@misfinanzas.com">
                            <span style="font-size: 24px;">📧</span>
                            <span>Email</span>
                        </a>
                    </div>
                </div>
            </div>
        </Authorized>

        <NotAuthorized>
            @* Vista para usuarios NO autenticados (tu diseño original) *@
            <div style="min-height: 100vh; padding: 20px;">

                <!-- Navigation Bar -->
                <nav class="glass-nav animate-slide-up" style="padding: 15px 30px; margin-bottom: 40px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">

                    <div class="navigation-bar">
                        <div style="display: flex; align-items: center; gap: 10px;">

                            <img src="/images/MisFinanzas.png" alt="Mis Finanzas Logo" style="width: 40px; height: 40px;" />

                            <h3 style="margin: 0; color: white; font-weight: 600;">Mis Finanzas</h3>
                        </div>
                        <div class="links" style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <a href="/Account/Register" class="btnLogin" id="home-register-button">Registrar</a>
                            <a href="/Account/Login" class="btnLogin" id="home-login-button">Iniciar sesión</a>
                        </div>

                    </div>
                    
                </nav>

                <!-- Hero Section -->
                <div class="glass-card animate-slide-up animate-delay-1" style="padding: 20px 20px; text-align: center; margin-bottom: 20px; display:grid;">
                    <div class="title" style="display:flex; align-items:center; margin:0 auto; flex-wrap: wrap; justify-content: center; gap: 10px;">
                        <img src="/images/MisFinanzas.png" alt="Mis Finanzas Logo" style="width: 100px; height: 100px;" />
                        <h1 style="color: white; font-size: 2.5rem; margin-bottom: 8px; margin-top:0px; font-weight: 600;">
                            Mis Finanzas
                        </h1>
                    </div>
                    <p class="text-white" style="font-size: 1.3rem; max-width: 600px; margin: 0 auto;">
                        Toma el control de tu dinero con inteligencia, simplicidad, y con ayuda de Finn 🤖
                    </p>
                    <p class="text-white">
                        Tu asistente financiero personal con Inteligencia Artificial.
                        <br>
                        Háblale por texto o voz, pídele que registre gastos o que cree categorías por ti.
                    </p>
                </div>

                <div style="display: flex; justify-content: center; align-items: center; width: 100%;">

                    <!-- Features Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px; width: 100%; max-width: 900px; padding: 0 20px;">

                        <!-- FILA 1: Categorías + Presupuestos -->
                        <!-- Categories Card -->
                        <div class="glass-card animate-slide-up animate-delay-3" id="home-categories-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🏷️</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Categorías</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Organiza tus finanzas por categorías personalizadas
                            </p>
                            <div>
                                <img src="images/Categories-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                          
                        </div>

                        <!-- Budgets Card -->
                        <div class="glass-card animate-slide-up animate-delay-3" id="home-budgets-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">💰</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Presupuestos</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Controla tus gastos mensuales por categoría
                            </p>
                            <div>
                                <img src="images/Budgets-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                            
                        </div>

                        <!-- FILA 2: Gastos e Ingresos + Recordatorios -->
                        <!-- Transactions Card -->
                        <div class="glass-card animate-slide-up animate-delay-4" id="home-transactions-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">💳</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Gastos e ingresos</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Registra y visualiza cada movimiento de dinero
                            </p>
                            <div>
                                <img src="images/Expenses-incomes-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                            
                        </div>

                        <!-- Reminders/Notifications Card (NUEVO) -->
                        <div class="glass-card animate-slide-up animate-delay-4" id="home-reminders-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🔔</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Recordatorios</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Notificaciones de gastos fijos y pagos pendientes
                            </p>
                            <div>
                                <img src="images/Reminders-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                            
                        </div>

                        <!-- FILA 3: Metas Financieras + Préstamos -->
                        <!-- Financial Goals Card -->
                        <div class="glass-card animate-slide-up animate-delay-5" id="home-goals-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🎯</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Metas financieras</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Define objetivos y alcanza tus sueños
                            </p>
                            <div>
                                <img src="images/Goals-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                            
                        </div>

                        <!-- Loans Card (NUEVO) -->
                        <div class="glass-card animate-slide-up animate-delay-5" id="home-loans-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">🏦</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Préstamos</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Gestiona tus préstamos y cuotas mensuales
                            </p>
                            <div>
                                <img src="images/Loans-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                           
                        </div>
                    </div>
                </div>

                <!-- FILA 4: Panel de Control (ancho completo) -->
                <div style="display: flex; justify-content: center; margin-top: 30px;">
                    <div style="width: 100%; max-width: 900px; padding: 0 20px;">
                        <div class="glass-card animate-slide-up animate-delay-2" id="home-dashboard-card" style="padding: 30px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">📊</span>
                                <h2 style="color: white; margin: 0; font-size: 1.5rem;">Panel de control</h2>
                            </div>
                            <p class="text-white" style="margin-bottom: 20px;">
                                Visualiza tu situación financiera de un vistazo
                            </p>
                            <div>
                                <img src="images/Balance-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                            </div>                       
                            <!-- Contenedor de ambos gráficos - RESPONSIVE -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; align-items:center;">

                                <!-- Gráfico de barras -->
                                <div style="margin: 0 auto; margin-right:30px;">
                                    <img src="images/Barchart-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                                </div>                                
                                <!-- Gráfico de dona (NUEVO) -->
                                <div style="margin: 0 auto; margin-right:30px;">
                                    <img src="images/Donut-demo.png" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy" alt="Vista previa de Categorias">
                                </div>                                
                            </div>                        
                        </div>
                    </div>
                </div>

                <!-- Call to Action - Manual de Usuario -->
                <div class="glass-card animate-slide-up" style="padding: 50px 40px; text-align: center; margin-top: 60px; margin-bottom: 40px;">
                    <h2 style="color: white; font-size: 2rem; margin-bottom: 15px;">¿Deseas una guía detallada de cómo usar la app?</h2>
                    <p style="color: white; font-size: 1.1rem; margin-bottom: 30px;">
                        Aprende como administrar tus finanzas
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btnLogin" id="home-download-manual-button" style="font-size: 1.1rem; padding: 14px 32px;" @onclick="DownloadUserManual">
                            📥 Descargar manual de usuario
                        </button>
                    </div>
                </div>

                <!-- Contact Card (NUEVO) -->
                <div class="glass-card animate-slide-up" id="home-contact-card" style="padding: 40px; text-align: center; margin-bottom: 40px;">
                    <h2 style="color: white; font-size: 1.8rem; margin-bottom: 10px;">📞 ¿Necesitas ayuda?</h2>
                    <p style="color: white; font-size: 1rem; margin-bottom: 25px;">
                        Contáctanos y con gusto te asistiremos
                    </p>

                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <!-- WhatsApp -->
                        <a class="btnWhatsApp" href="https://wa.me/18295346850" target="_blank">
                            <span style="font-size: 24px;">💬</span>
                            <span>WhatsApp</span>
                        </a>

                        <!-- Email -->
                        <a class="btnEmail" href="mailto:soporte@misfinanzas.com">
                            <span style="font-size: 24px;">📧</span>
                            <span>Email</span>
                        </a>
                    </div>
                </div>

            </div>
        </NotAuthorized>
    </AuthorizeView>

</div>

<FloatingHelpButton OnClick="StartTour" Icono="?" Titulo="Ayuda" Bottom="90" Id="btn-help" />




@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        // Inicializar currentUrl
        currentUrl = Navigation.ToBaseRelativePath(Navigation.Uri);
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = Navigation.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // NUEVO: Iniciar tour automáticamente si es primera vez
            await Task.Delay(500); // Pequeño delay para que cargue la UI
            await JSRuntime.InvokeVoidAsync("tourService.startTourIfFirstTime", "home");
        }
    }

    private async Task StartTour()
    {
        await JSRuntime.InvokeVoidAsync("tourService.startHomeTour");
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }

    

    private async Task DownloadUserManual()
    {
        try
        {
            // Por ahora, usar un PDF de prueba
            // Cuando tengas el manual real, reemplaza la ruta
            await JSRuntime.InvokeVoidAsync("downloadFile", "manual-usuario.pdf", "Manual de Usuario - Mis Finanzas.pdf");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al descargar manual: {ex.Message}");
        }
    }
}
    





